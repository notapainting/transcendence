<!-- <!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Transcentest</title>
	
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
	<link rel="stylesheet" href="assets/style.css"> 

</head>
<body>
	<div id="navbar">
		<nav class="navbar navbar-inverse">
			<div class="container-fluid">
				<div class="navbar-header">
					<a class="navbar-brand" href="#">Transcendence</a>
				</div>
				<ul class="nav navbar-nav">
					<li id="accID" class="active"><a href="#accueil">Accueil</a></li>
					<li id="jeuID" ><a href="#jeu">Jeu</a></li>
					<li id="chatID" ><a href="#chat">Chat</a></li>
				</ul>
				<div id="connexion-content">
					<ul class="nav navbar-nav navbar-right">
						<li><a href="#signup"><span class="glyphicon glyphicon-user"></span> Sign Up</a></li>
						<li><a href="#signin"><span class="glyphicon glyphicon-log-in"></span> Login</a></li>
					</ul>
				</div>
			</div>
		</nav>
	</div>

	<main id="content">

		<div id="signup-content" class="page-content" style="display: none;">
	
		</div>

		<div id="signin-content" class="page-content" style="display: none;">
			<div class="wrapper fadeInDown">
				<div id="formContent">
				  <form id="loginForm">
					<input type="text" id="login" class="fadeIn second" name="login" placeholder="login">
					<input type="email" id="email" class="fadeIn second" name="email" placeholder="email">
					<input type="password" id="password" class="fadeIn third" name="login" placeholder="password">
					<input type="submit" class="fadeIn fourth" value="Log In">
				  </form>
			
				  <div id="formFooter">
					<a class="underlineHover" href="#">Forgot Password?</a>
				  </div>
			  
				</div>
			</div>
		</div>



		<div id="accueil-content" class="page-content" style="display: none;">
			<h1>Bienvenue sur Transcendence !</h1>
		</div>

		<div id="jeu-content" class="page-content" style="display: none;">
			<h1 id="scoreMessage"></h1>
			<div class="containerGame">
				<canvas id="canvas" width="900" height="600">
			</div>
			<div id="gameButton">
				<button id="startButton" class="button" type="button">Start</button> 
				<button id="stopButton" class="button" type="button">Stop</button> 
				<button id="backButton" class="button" type="button">Back test</button> 
			</div>
		</div> 

		<div id="chat-content" style="display: none;">
			<h1 id="chat-text" class="text-center"> Chat in progress .. </h1>
		</div>
	</main>
	

    <footer class="footer">
        <div class="containerFooter">
            <span class="text-muted">Transcendence &copy; 2024</span>
        </div>
    </footer>

	<script src="assets/app.js"></script>
	<script src="assets/game.js"></script>
	<script src="assets/connexion.js"></script>
</body>
</html> -->

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test des vues</title>
    <style>
        /* Styles CSS pour la mise en forme */
        body {
            font-family: Arial, sans-serif;
        }
        .container {
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
            border: 1px solid #ccc;
            border-radius: 5px;
            background-color: #f9f9f9;
        }
        input[type="text"],
        input[type="email"],
        input[type="password"],
        input[type="file"],
        button {
            display: block;
            width: 100%;
            margin-bottom: 10px;
            padding: 8px;
            font-size: 16px;
        }
        button {
            background-color: #007bff;
            color: #fff;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        button:hover {
            background-color: #0056b3;
        }
        .response {
            margin-top: 20px;
            padding: 10px;
            border-radius: 4px;
            background-color: #fff;
        }
        .error {
            color: #ff0000;
        }
    </style>
</head>
<body>
    <div class="container">
        <h2>Test des vues</h2>

        <h3>Connexion avec username et mot de passe</h3>
        <input type="text" id="loginUsername" placeholder="Nom d'utilisateur">
        <input type="password" id="loginPassword" placeholder="Mot de passe">
        <button onclick="login()">Se connecter</button>
        <div id="loginResponse" class="response"></div>
        <button onclick="authenticateWith42()">Se connecter avec 42</button>
        <div id="userInfo" class="user-info" style="display: none;">
            <img id="profilePicture" src="" alt="Photo de profil">
            <div id="username"></div>
            <div id="email"></div>
            <h3>Modifier la photo de profil</h3>
            <input type="file" id="profilePictureInput">
            <button onclick="updateProfilePicture()">Modifier</button>
            <div id="updateProfilePictureResponse" class="response"></div>
        </div>
        <div class="container">
            <h2>Test des vues</h2>
    
            <h3>Activer l'authentification à deux facteurs</h3>
            <button onclick="activate2FA()">Activer l'authentification à deux facteurs</button>
            <div id="activate2FAResponse" class="response"></div>
            <div id="qrCodeContainer"></div>
            <h3>Confirmer l'activation de l'authentification à deux facteurs</h3>
            <input type="text" id="code" placeholder="Code à entrer">
            <button onclick="confirm2FA()">Confirmer l'activation</button>
            <div id="confirm2FAResponse" class="response"></div>
        </div>
    
        <h3>Créer un utilisateur</h3>
        <input type="text" id="username-create" placeholder="Nom d'utilisateur">
        <input type="email" id="email-create" placeholder="Adresse email">
        <input type="password" id="password-create" placeholder="Mot de passe">
        <button onclick="createUser()">Créer l'utilisateur</button>
        <div id="createUserResponse" class="response"></div>

        <h3>Vérifier le token</h3>
        <input type="text" id="token" placeholder="Token JWT">
        <button onclick="validateToken()">Valider le token</button>
        <div id="validateTokenResponse" class="response"></div>

        <h3>Réinitialiser le mot de passe</h3>
        <input type="email" id="resetEmail" placeholder="Adresse email">
        <button onclick="resetPassword()">Envoyer le lien de réinitialisation</button>
        <div id="resetPasswordResponse" class="response"></div>

        <h3>Actualiser le token</h3>
        <input type="text" id="refreshToken" placeholder="Token JWT">
        <button onclick="refreshToken()">Actualiser le token</button>
        <div id="refreshTokenResponse" class="response"></div>
    </div>

    <script>
        // Fonction pour créer un utilisateur
        function createUser() {
            const username = document.getElementById('username-create').value;
            const email = document.getElementById('email-create').value;
            const password = document.getElementById('password-create').value;
            const data = {
                username: username,
                email: email,
                password: password
            };
            fetch('/auth/signup/', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(data)
            })
            .then(response => response.json())
            .then(data => {
                document.getElementById('createUserResponse').innerText = JSON.stringify(data);
            })
            .catch(error => {
                document.getElementById('createUserResponse').innerText = 'Erreur : ' + error.message;
            });
        }

        // Fonction pour valider le token
        function validateToken() {
            const token = document.getElementById('token').value;
            const data = {
                token: token
            };
            fetch('/auth/validate_token/', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(data)
            })
            .then(response => response.json())
            .then(data => {
                document.getElementById('validateTokenResponse').innerText = JSON.stringify(data);
            })
            .catch(error => {
                document.getElementById('validateTokenResponse').innerText = 'Erreur : ' + error.message;
            });
        }

        // Fonction pour réinitialiser le mot de passe
        function resetPassword() {
            const email = document.getElementById('resetEmail').value;
            const data = {
                email: email
            };
            fetch('/auth/reset_password/', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(data)
            })
            .then(response => response.json())
            .then(data => {
                document.getElementById('resetPasswordResponse').innerText = JSON.stringify(data);
            })
            .catch(error => {
                document.getElementById('resetPasswordResponse').innerText = 'Erreur : ' + error.message;
            });
        }

        // Fonction pour actualiser le token
        function refreshToken() {
            const token = document.getElementById('refreshToken').value;
            const data = {
                refresh: token
            };
            fetch('/auth/token/refresh/', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(data)
            })
            .then(response => response.json())
            .then(data => {
                document.getElementById('refreshTokenResponse').innerText = JSON.stringify(data);
            })
            .catch(error => {
                document.getElementById('refreshTokenResponse').innerText = 'Erreur : ' + error.message;
            });
        }

        function login() {
            const username = document.getElementById('loginUsername').value;
            const password = document.getElementById('loginPassword').value;
            const data = {
                username: username,
                password: password
            };
            fetch('/auth/token/', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(data)
            })
            .then(response => response.json())
            .then(data => {
                // Vérifier si la connexion est réussie
                if (data.access) {
                    // Enregistrer le token dans le localStorage
                    localStorage.setItem('jwtToken', data.access);
                    // Afficher les informations de l'utilisateur
                    document.getElementById('profilePicture').src = `https://localhost:8443${data.profile_picture}`;
                    document.getElementById('username').innerText = `Nom d'utilisateur: ${data.username}`;
                    document.getElementById('email').innerText = `Email: ${data.email}`;
                    // Afficher la section userInfo
                    document.getElementById('userInfo').style.display = 'block';
                    // Cacher le formulaire de connexion
                    document.getElementById('loginResponse').innerText = '';
                } else {
                    // Afficher un message d'erreur si la connexion a échoué
                    document.getElementById('loginResponse').innerText = 'Erreur : Nom d\'utilisateur ou mot de passe incorrect.';
                }
            })
            .catch(error => {
                document.getElementById('loginResponse').innerText = 'Erreur : ' + error.message;
            });
        }

        // Fonction pour mettre à jour la photo de profil
        function updateProfilePicture() {
            const token = localStorage.getItem('jwtToken');
            const profilePictureInput = document.getElementById('profilePictureInput');
            const profilePicture = profilePictureInput.files[0];
            const formData = new FormData();
            formData.append('profile_picture', profilePicture);
            fetch('https://localhost:8443/auth/update_picture/', {
                method: 'PUT',
                headers: {
                    'Authorization': `Bearer ${token}`
                },
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                document.getElementById('updateProfilePictureResponse').innerText = JSON.stringify(data);
            })
            .catch(error => {
                document.getElementById('updateProfilePictureResponse').innerText = 'Erreur : ' + error.message;
            });
        }
        function authenticateWith42() {
    fetch('auth/authenticate_with_42/', {
        method: 'GET',
        redirect: 'follow' // Suivre les redirections
    })
    .then(response => {
        if (!response.ok) {
            throw new Error('Erreur lors de la connexion avec l\'école 42');
        }
        // Extraire l'URL de redirection depuis la réponse JSON
        return response.json();
    })
    .then(data => {
        // Récupérer l'URL d'autorisation de l'école 42 depuis les données JSON
        const authorizationUrl = data.authorization_url;
        // Rediriger l'utilisateur vers l'URL d'autorisation de l'école 42
        window.location.href = authorizationUrl;
    })
    .catch(error => {
        document.getElementById('loginResponse').innerText = 'Erreur : ' + error.message;
    });
}
function activate2FA() {
    const token = localStorage.getItem('jwtToken'); // Récupérer le token d'access
    fetch('/auth/activate2FA/', {
        method: 'POST',
        headers: {
            'Authorization': `Bearer ${token}`, // Ajouter le token d'access à l'en-tête Authorization
            'Content-Type': 'application/json'
        }
    })
    .then(response => response.json())
    .then(data => {
        const qrImgBase64 = data.qr_img; // Récupérer l'image du QR code base64 depuis la réponse JSON
        // Créer un élément <img> pour afficher l'image du QR code
        const qrImgElement = document.createElement('img');
        qrImgElement.src = 'data:image/png;base64,' + qrImgBase64; // Définir la source de l'image sur l'image QR base64
        qrImgElement.alt = 'QR Code'; // Ajouter une description alternative pour l'image
        // Ajouter l'élément <img> à un conteneur existant dans votre HTML
        const container = document.getElementById('qrCodeContainer');
        container.innerHTML = ''; // Effacer le contenu précédent du conteneur
        container.appendChild(qrImgElement); // Ajouter l'élément <img> au conteneur
    })
    .catch(error => {
        document.getElementById('activate2FAResponse').innerText = 'Erreur : ' + error.message;
    });
}
    function confirm2FA() {
        const token = localStorage.getItem('jwtToken'); // Récupérer le token d'access
        const code = document.getElementById('code').value; // Récupérer le code de confirmation depuis l'élément HTML
        console.log(code);
        console.log('yo')
        fetch('/auth/confirm2FA/', {
            method: 'POST',
            headers: {
                'Authorization': `Bearer ${token}`, // Ajouter le token d'access à l'en-tête Authorization
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ code: code }) // Envoyer le code de confirmation dans le corps de la requête
        })
        .then(response => response.json())
        .then(data => {
            // Traiter la réponse du serveur
            document.getElementById('confirm2FAResponse').innerText = JSON.stringify(data);
        })
        .catch(error => {
            // Gérer les erreurs
            document.getElementById('confirm2FAResponse').innerText = 'Erreur : ' + error.message;
        });
    }
    // Extraction des paramètres de l'URL
    const urlParams = new URLSearchParams(window.location.search);
    const username = urlParams.get('username');
    const profilePicture = urlParams.get('profile_picture');
    const email = urlParams.get('email');

    // Affichage des informations de l'utilisateur dans la div userInfo
    document.getElementById('profilePicture').src = profilePicture;
    document.getElementById('username').innerText = `Nom d'utilisateur: ${username}`;
    document.getElementById('email').innerText = `Email: ${email}`;

    // Afficher la section userInfo
    document.getElementById('userInfo').style.display = 'block';

    </script>
</body>
</html>
